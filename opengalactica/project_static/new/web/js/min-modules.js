var global={documentReady:function(){$(".popup_region").popupWindow({height:500,width:450,centerScreen:1,scrollbars:1});$(".popup_ship").popupWindow({height:500,width:450,centerScreen:1,scrollbars:1});$(".popup_planet_avatar").popupWindow({height:600,width:880,centerScreen:1,scrollbars:1});$(".popup_planet").popupWindow({height:580,width:790,centerScreen:1,scrollbars:1});$(".popup_galaxy").popupWindow({height:580,width:790,centerScreen:1,scrollbars:1});$(".popup_alliance").popupWindow({height:580,width:790,centerScreen:1,scrollbars:1});global.rollover.init()},trim:function(b){b=b.replace(/^\s+/,"");for(var a=b.length-1;a>=0;a--){if(/\S/.test(b.charAt(a))){b=b.substring(0,a+1);break}}return b},textArrayReplace:function(c,b,a){$.each(c,function(e,d){a=a.replace(new RegExp(d,"g"),b[e])});return a},createSeeker:function(e,c,d,a,b){app='<div class="line"></div>\n<div class="pager right"></div>\n<div class="pager left"></div>\n<div class="seek"></div>\n';$(e).html(app);$(e).addClass("seeker");$(e).children(".seek").width($(e).width()-39);$(e).children(".seek").css("float","left");$(e).children(".seek").slider({min:c,max:d,value:b,slide:function(){$(a).val($(e).children(".seek").slider("option","value"));$(a).change()},change:function(){$(a).val($(e).children(".seek").slider("option","value"));$(a).change()}});$(e).children(".right").click(function(){if($(e).children(".seek").slider("option","value")<d){$(e).children(".seek").slider("option","value",$(e).children(".seek").slider("option","value")+1)}});$(e).children(".left").click(function(){if($(e).children(".seek").slider("option","value")>c){$(e).children(".seek").slider("option","value",$(e).children(".seek").slider("option","value")-1)}});$(e).children(".line").width(parseInt($(e).css("width"))-30);$(e).children(".line").css("left",22);$(e).children(".line").css("top",6)},message:{show:function(b,d,c,a,e){if(b==null){b="body"}app='<div class="popup_message">\n  <h2>'+d+' <a href="#" class="popupclose">x</a></h2>\n  <p>'+c+'</p>\n  <div class="button"><a href="#" class="button_small popupclose"><span class="left"></span><span class="txt">'+(a==undefined?"OK":a)+'</span><span class="right"></span></a></div>\n</div>\n<div class="blacklayer" id="msgbg"></div>';$("body").append(app);$(".popup_message").position({of:$(b),my:"center center",at:"center center"});$(".blacklayer").height(document.getRealHeight());$(".blacklayer").fadeTo("fast",0.6);$(".popup_message").fadeIn("fast");$(".popupclose").click(function(){if(e!=undefined){e()}global.message.hide();return false})},hide:function(){$("#msgbg").fadeOut("fast",function(){$("#msgbg").remove()});$(".popup_message").fadeOut("fast",function(){$(".popup_message").remove()})}},loadingLayer:{savePos:null,parent:null,show:function(a){app='<div class="blacklayer loading" id="loading"></div>';if(a==undefined){$("body").append(app)}else{global.loadingLayer.parent=a;global.loadingLayer.savePos=$(a).css("position");$(a).css("position","relative");$(a).append(app)}$(".blacklayer").height((a==undefined)?document.getRealHeight():$(a).outerHeight());$(".blacklayer").fadeTo("fast",0.6)},hide:function(){$("#loading").fadeOut("fast",function(){if(global.loadingLayer.parent){$(global.loadingLayer.parent).css("position",global.loadingLayer.savePos)}$("#loading").remove()})}},numberFormat:function(b,c){if(parseInt(b)==0){if(c!=undefined){return c}else{return 0}}else{b+="";x=b.split(".");x1=x[0];x2=x.length>1?"."+x[1]:"";var a=/(\d+)(\d{3})/;while(a.test(x1)){x1=x1.replace(a,"$1 $2")}return x1+x2}},rollover:{init:function(){$("img.rollover").mouseover(function(a){src=$(a.target).attr("src").match(/^(.+)(\.[a-zA-Z]{3})/);$(a.target).attr("src",src[1]+"_over"+src[2])});$("img.rollover").mouseout(function(a){src=$(a.target).attr("src").match(/^(.+)_over(\.[a-zA-Z]{3})/);$(a.target).attr("src",src[1]+src[2])})}}};document.getRealHeight=function getDocHeight(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))};$(document).ready(function(){global.documentReady()});var planetProfileHistory={showRangDesc:function(){$(".PlanetProfileHistory-rangdesc").show()},hideRangDesc:function(){$(".PlanetProfileHistory-rangdesc").hide()}};var checkController={waitTime:1000,inQueue:0,requests:{},controllers:{},init:function(c,b,d,a){checkController.requests[c]={};checkController.requests[c].url=b;checkController.requests[c].default_params=d;checkController.requests[c].params={};checkController.requests[c].states=a},addController:function(b,a,c,d){if(checkController.controllers[b]==null){checkController.controllers[b]={}}checkController.controllers[b][a]={};checkController.controllers[b][a].el=c;checkController.controllers[b][a].real_state=d;checkController.controllers[b][a].enabled=true},click:function(b,a){if(checkController.requests[b].disable_controls){return}var c=checkController.controllers[b][a].el;var d=checkController.getElementState(c,b);checkController.setElementState(c,d.now,d.next);checkController.addRequest(b,a,d.next)},addRequest:function(b,a,d){var c=checkController.requests[b];c.params["param_"+a]=d;c.hasParam=true;if(c.inQueue==null){c.inQueue=0}c.inQueue++;setTimeout(function(){checkController.sendRequest(b)},checkController.waitTime)},sendRequest:function(a){var b=checkController.requests[a];b.inQueue--;if(b.inQueue==0){if(b.hasParam){b.send_params=$.extend(true,{},b.params,b.default_params);b.hasParam=false;b.params={};b.disable_controls=true;$.ajax({url:b.url,type:"POST",data:b.send_params,error:function(){$.each(b.send_params,function(d){if(checkController.controllers[a][d]!=null){var e=checkController.controllers[a][d].el;var f=checkController.getElementState(e,a);var c=checkController.controllers[a][d].real_state;checkController.setElementState(e,f.now,c)}})},success:function(){$.each(b.send_params,function(c){if(checkController.controllers[a][c]!=null){var d=b.send_params[c];checkController.controllers[a][c].real_state=d}})},complete:function(){b.disable_controls=false}})}}},getElementState:function(b,a){var c={now:"",next:"",first:""};$.each(checkController.requests[a].states,function(d){var e=checkController.requests[a].states[d];if(c.first==""){c.first=e}if(c.now!=""&&c.next==""){c.next=e}if(b.hasClass(e)){c.now=e}});if(c.next==""){c.next=c.first}return c},setElementState:function(c,b,a){c.removeClass(b).addClass(a)}};var tabController={fadeInterval:300,controllers:{},changeTab:function(f,d,g,e){var c=tabController.controllers[f];var a=c.activeTab;c.activeTab=g;tabController.activateButton(f,d,g);tabController.deactivateButton(f,d,a);c.newContent="";c.fadeInSuccess=true;var b=tabController.hasContent(f,g);if(!b){$.ajax({url:e,success:function(h){c.newContent=h;if(!c.fadeInSuccess){tabController.setContent(f,g,c.newContent);tabController.changeContentDiv(f,g,a);global.documentReady();tabController.fade(f,false,function(){tabController.setWait(f,false)})}}})}tabController.setWait(f,true);tabController.fade(f,true,function(){if(!b){if(c.newContent!=""){tabController.setContent(f,g,c.newContent);tabController.changeContentDiv(f,g,a);global.documentReady();tabController.fade(f,false,function(){tabController.setWait(f,false)});c.fadeInSuccess=true}c.fadeInSuccess=false}else{tabController.changeContentDiv(f,g,a);global.documentReady();tabController.fade(f,false,function(){tabController.setWait(f,false)})}})},activateButton:function(b,a,c){$(".global-tabs #"+b+"-"+a+"-off-"+c).hide();$(".global-tabs #"+b+"-"+a+"-on-"+c).show()},deactivateButton:function(b,a,c){$(".global-tabs #"+b+"-"+a+"-on-"+c).hide();$(".global-tabs #"+b+"-"+a+"-off-"+c).show()},changeContentDiv:function(a,b,c){$(".global-tabs #content-"+a+"-"+c).hide();$(".global-tabs #content-"+a+"-"+b).show()},hasContent:function(a,b){return global.trim($(".global-tabs #content-"+a+"-"+b).html())!=""},setContent:function(a,b,c){$(".global-tabs #content-"+a+"-"+b).html(c)},fade:function(b,a,c){if(a){$(".global-tabs #content-"+b).fadeTo(tabController.fadeInterval,0.00001,c)}else{$(".global-tabs #content-"+b).fadeTo(tabController.fadeInterval,1,c)}},setWait:function(b,a){if(a){$(".global-tabs #content-wait-"+b).addClass("content-wait")}else{$(".global-tabs #content-wait-"+b).removeClass("content-wait")}},mouseOut:function(c,d,b,a){$(".global-tabs #"+c+"-"+b+"-off-left-"+d).removeClass(b+"-"+a+"-left").addClass(b+"-off-left");$(".global-tabs #"+c+"-"+b+"-off-bg-"+d).removeClass(b+"-"+a+"-bg").addClass(b+"-off-bg");$(".global-tabs #"+c+"-"+b+"-off-right-"+d).removeClass(b+"-"+a+"-right").addClass(b+"-off-right")},mouseOver:function(c,d,b,a){$(".global-tabs #"+c+"-"+b+"-off-left-"+d).removeClass(b+"-off-left").addClass(b+"-"+a+"-left");$(".global-tabs #"+c+"-"+b+"-off-bg-"+d).removeClass(b+"-off-bg").addClass(b+"-"+a+"-bg");$(".global-tabs #"+c+"-"+b+"-off-right-"+d).removeClass(b+"-off-right").addClass(b+"-"+a+"-right")}};fleetMove={tmr:new Array(),errtmr:null,active:false,info:null,clickNumber:function(b){if(jQuery.browser.msie){b.cancelBubble=true}else{b.stopPropagation()}if(fleetMove.active!==false){fleetMove.doHide("#"+fleetMove.active)}fleetMove.info={fleet_id:null,ship_id:null,num:parseInt($.trim($(b.target).html()).replace(" ",""))};var a=$(b.target).attr("id").match(/^fleet_([0-9]+)_([0-9]+)$/);fleetMove.info.fleet_id=parseInt(a[1]);fleetMove.info.ship_id=parseInt(a[2]);if(fleetMove.info.num<=0||$.inArray(fleetMove.info.fleet_id,disabledFleets)>-1){return false}fleetMove.active="fleet_"+fleetMove.info.fleet_id+"_"+fleetMove.info.ship_id+"_over";if($("#"+fleetMove.active).length==0){fleetMove.createOverLayer(b.target,fleetMove.info)}$(b.target).addClass("calc");$(".ship_"+fleetMove.info.ship_id).addClass("calc");$("#fleet_"+fleetMove.info.fleet_id).addClass("calc");$(b.target).addClass("calc");fleetMove.showOverLayer(fleetMove.active);return false},createOverLayer:function(a,b){var d=new Array("#1","#2","#3");var c=new Array($(".ship_"+b.ship_id+" > img").attr("src"),$(".ship_"+b.ship_id+":first").html().replace(/<\/?[^>]+>/gi,""),(b.fleet_id==0)?lng.fleetControll_Base:lng.fleetControll_Fleet+" "+b.fleet_id);app='<div id="'+fleetMove.active+'" class="ship_move overlayer" style="visibility: hidden; opacity: 0.0001">\n<h2>'+lng.fleetControll_ShipMoveHeader+' <a href="#" class="close">x</a></h2>\n<div class="top bordercolor">\n  <span class="bordercolor" title="'+global.textArrayReplace(d,c,lng.fleetControll_ShipMoveTop).replace(/<\/?[^>]+>/gi,"")+'"><img src="'+$(".ship_"+b.ship_id+" > img").attr("src")+'" alt="'+$(".ship_"+b.ship_id+" > img").attr("alt")+'" title="'+$(".ship_"+b.ship_id+" > img").attr("title")+'" />'+global.textArrayReplace(d,c,lng.fleetControll_ShipMoveTop).substr(0,33)+' ...</span></div>\n<div class="input bordercolor">\n<input type="button" class="step button_mini" value="-1" />\n<input type="button" class="step button_mini" value="+1" />\n<input type="text" name="shipnum" id="shipnum" value="'+b.num+'" class="num" onkeypress="return NumberConverter(event)" />\n</div>\n<div class="seekerpos bordercolor">\n  <div>\n    <input type="button" class="button_mini" value="1/4" onclick="$(\'#\'+fleetMove.active+\' > .seeker > .seek\').slider(\'option\',\'value\','+parseInt(b.num*0.25)+")\" />\n    <input type=\"button\" class=\"button_mini\" value=\"1/2\" onclick=\"$('#'+fleetMove.active+' > .seeker > .seek').slider('option','value',"+parseInt(b.num*0.5)+")\" />\n    <input type=\"button\" class=\"button_mini\" value=\"3/4\" onclick=\"$('#'+fleetMove.active+' > .seeker > .seek').slider('option','value',"+parseInt(b.num*0.75)+')" />\n  </div>\n  <div>\n    <input type="button" class="button_mini" value="1'+lng.fleetControll_ShipMoveNum+"\" onclick=\"$('#'+fleetMove.active+' > .seeker > .seek').slider('option','value',1)\" />\n    <input type=\"button\" class=\"button_mini\" value=\"1/3\" onclick=\"$('#'+fleetMove.active+' > .seeker > .seek').slider('option','value',"+parseInt(b.num/3)+")\" />\n    <input type=\"button\" class=\"button_mini\" value=\"2/3\" onclick=\"$('#'+fleetMove.active+' > .seeker > .seek').slider('option','value',"+parseInt((b.num/3)*2)+')" />\n    <input type="button" class="button_mini" value="'+lng.fleetControll_ShipMoveAll+"\"  onclick=\"$('#'+fleetMove.active+' > .seeker > .seek').slider('option','value',"+b.num+')" />\n  </div>\n</div>\n<div class="seeker bordercolor">\n</div>\n<div style="height: 0px; clear:both;"></div>\n<div class="buttons bordercolor">\n';var d=new Array("#2","#3");var c=new Array($(".ship_"+b.ship_id+":first").html().replace(/<\/?[^>]+>/gi,""),lng.fleetControll_Base);buttonText=(b.fleet_id==0)?lng.fleetControll_FleetNotAvailable:global.textArrayReplace(d,c,lng.fleetControll_shipMoveToFleetButtonHint);app+='<input type="button" name="fleet0" title="'+buttonText+'" rel="'+buttonText+'" value="'+lng.fleetControll_Base+'" class="button_small'+(b.fleet_id==0?' inactive"':'" onclick="fleetMove.moveTo(0)"')+" />";for(i=1;i<=4;i++){c[1]=lng.fleetControll_Fleet+" "+i;buttonText=(i==b.fleet_id||$.inArray(i,disabledFleets)>-1)?lng.fleetControll_FleetNotAvailable:global.textArrayReplace(d,c,lng.fleetControll_shipMoveToFleetButtonHint);app+='<input title="'+buttonText+'" rel="'+buttonText+'" type="button" name="fleet'+i+'" value="'+lng.fleetControll_Fleet+" "+i+'" class="button_small'+(i==b.fleet_id||$.inArray(i,disabledFleets)>-1?' inactive"':'" onclick="fleetMove.moveTo('+i+')"')+" />"}app+="</div>\n  </div>";$("#fleet > .content").append(app);global.createSeeker($("#"+fleetMove.active+" > .seeker"),1,b.num,$("#"+fleetMove.active+" > .input > input[name|=shipnum]"),b.num);$("#"+fleetMove.active+" > .input > input[name|=shipnum]").bind("keyup",fleetMove.editField);$("#"+fleetMove.active+" > .input > input[name|=shipnum]").bind("change",function(){$("#"+fleetMove.active+" > .buttons > input").each(function(f,g){$(g).attr("title",$(g).attr("rel").replace("#1",$("#"+fleetMove.active+" > .input > input[name|=shipnum]").val()))})});$("#"+fleetMove.active+" > .input > input[name|=shipnum]").change();pos=$(a).position();$("#"+fleetMove.active).css({left:pos.left-80,top:pos.top-111});$("#"+fleetMove.active+" > *").bind("mouseover",function(f){clearTimeout(fleetMove.tmr[parseInt(fleetMove.info.fleet_id+""+fleetMove.info.ship_id)])});$("#"+fleetMove.active+" > div").bind("mouseout",function(f){fleetMove.hideOverLayer(f)});$("#"+fleetMove.active+" > h2 > a.close").bind("click",function(e){if(jQuery.browser.msie){e.cancelBubble=true}else{e.stopPropagation()}fleetMove.doHide($(e.target).parents(".overlayer"));return false});$("#"+fleetMove.active+" > .input > .step[value|=-1]").click(function(){$("#"+fleetMove.active+" > .seeker > .left").click()});$("#"+fleetMove.active+" > .input > .step[value|=+1]").click(function(){$("#"+fleetMove.active+" > .seeker > .right").click()});$("#"+fleetMove.active).css("visibility","")},showOverLayer:function(a){$("#"+a).fadeTo("fast",1);$("#"+a+" > .input > input[name|=shipnum]").focus();$("#"+a+" > .input > input[name|=shipnum]").select()},hideOverLayer:function(a){if(!fleetMove.active){return false}fleetMove.tmr[parseInt(fleetMove.info.fleet_id+""+fleetMove.info.ship_id)]=setTimeout(function(){fleetMove.doHide($(a.target).parents(".overlayer"))},1000)},doHide:function(b,a){if($(b).attr("id")==fleetMove.active){$("#fleet_"+fleetMove.info.fleet_id).removeClass("calc");$(".ship_"+fleetMove.info.ship_id).removeClass("calc");$("#fleet_"+fleetMove.info.fleet_id+"_"+fleetMove.info.ship_id).removeClass("calc");fleetMove.active=false}$(b).fadeOut("fast",function(){if(a){$(".overlayer").remove()}})},moveTo:function(a){fleetMove.showLoading();$.post("/new/web/fleet/move",{shipNum:$("#"+fleetMove.active+" > .input > input[name|=shipnum]").val(),shipId:fleetMove.info.ship_id,fromFleet:fleetMove.info.fleet_id,toFleet:a},function(b){if(b.status===true){$("#fleet_"+b.from.id+"_"+b.ship).fadeTo("fast",0.0001,function(){$("#fleet_"+b.from.id+"_"+b.ship).html(global.numberFormat(b.from.num));$("#fleet_"+b.from.id+"_"+b.ship).fadeTo("fast",1);if(b.from.id!=0){$(".galaxy_speed > .fleetdet_"+b.from.id).html(global.numberFormat(b.from.speed.galaxy,"-"));$(".system_speed > .fleetdet_"+b.from.id).html(global.numberFormat(b.from.speed.system,"-"));$(".universe_speed > .fleetdet_"+b.from.id).html(global.numberFormat(b.from.speed.universe,"-"));$(".galaxy_fuel > .fleetdet_"+b.from.id).html(global.numberFormat(b.from.fuel.galaxy,"-"));$(".system_fuel > .fleetdet_"+b.from.id).html(global.numberFormat(b.from.fuel.system,"-"));$(".universe_fuel > .fleetdet_"+b.from.id).html(global.numberFormat(b.from.fuel.universe,"-"))}if(b.to.id!=0){$(".galaxy_speed > .fleetdet_"+b.to.id).html(global.numberFormat(b.to.speed.galaxy,"-"));$(".system_speed > .fleetdet_"+b.to.id).html(global.numberFormat(b.to.speed.system,"-"));$(".universe_speed > .fleetdet_"+b.to.id).html(global.numberFormat(b.to.speed.universe,"-"));$(".galaxy_fuel > .fleetdet_"+b.to.id).html(global.numberFormat(b.to.fuel.galaxy,"-"));$(".system_fuel > .fleetdet_"+b.to.id).html(global.numberFormat(b.to.fuel.system,"-"));$(".universe_fuel > .fleetdet_"+b.to.id).html(global.numberFormat(b.to.fuel.universe,"-"))}fleetMove.rebuildClasses(b.from.id)});$("#fleet_"+b.to.id+"_"+b.ship).fadeTo("fast",0.0001,function(){$("#fleet_"+b.to.id+"_"+b.ship).html(global.numberFormat(b.to.num));$("#fleet_"+b.to.id+"_"+b.ship).fadeTo("fast",1);fleetMove.rebuildClasses(b.to.id)});fleetMove.doHide($("#fleet_"+b.from.id+"_"+b.ship+"_over"),true);fleetMove.doHide($("#fleet_"+b.to.id+"_"+b.ship+"_over"),true);$(".fleet_move").remove()}fleetMove.hideLoading()},"json");fleetMove.doHide("#"+fleetMove.active)},editField:function(a){$("#"+fleetMove.active+" > .seeker > .seek").slider("option","value",$(a.target).val());pos=$(element).position();$("#"+fleetMove.active).css({left:pos.left-80,top:pos.top-21})},clickFleet:function(b){if(fleetMove.active!==false){fleetMove.doHide("#"+fleetMove.active)}var a=$(b.target).attr("id").match(/^fleet_([0-9]+)$/);fleetMove.info={fleet_id:parseInt(a[1]),classes:new Array()};if($.inArray(fleetMove.info.fleet_id,disabledFleets)>-1||fleetClasses[fleetMove.info.fleet_id].length==0){return false}fleetMove.active="fleet_"+fleetMove.info.fleet_id+"_over";if($("#"+fleetMove.active).length==0){fleetMove.createOverLayerFleet(b.target,fleetMove.info)}$("#"+fleetMove.active+" > .classes > a.selected:not(.ship_class_all)").each(function(c,d){fleetMove.info.classes.push($(d).attr("rel")!="all"?parseInt($(d).attr("rel")):"all")});if(!$("#"+fleetMove.active+" > .classes > a.selected").length){$("#"+fleetMove.active+" > .classes > a.ship_class_all").click()}fleetMove.setFleetMoveTitle();$(b.target).addClass("calc");$("#"+fleetMove.active).fadeIn("fast");return false},createOverLayerFleet:function(a,b){var d=new Array("#1");var c=new Array((b.fleet_id==0)?lng.fleetControll_Base:lng.fleetControll_Fleet+" "+b.fleet_id);app='<div id="'+fleetMove.active+'" class="fleet_move overlayer" style="display:none;">\n<h2>'+lng.fleetControll_ShipMoveHeader+' <a href="#" class="close">x</a></h2>\n<div class="top"><span class="bordercolor" title="'+global.textArrayReplace(d,c,lng.fleetControll_FleetMoveTop)+'">'+global.textArrayReplace(d,c,lng.fleetControll_FleetMoveTop)+'</span></div>\n<div class="classes">';for(i=0;i<shipClasses.length;i++){app+='<a href="#" rel="'+shipClasses[i].id+'" class="button_small ship_class_'+shipClasses[i].id+($.inArray(shipClasses[i].id,fleetClasses[b.fleet_id])==-1?' inactive"':"")+'" onclick="fleetMove.clickClass(event,'+shipClasses[i].id+'); return false;" title="'+shipClasses[i].longName+'"><span class="left"></span><span class="txt">'+shipClasses[i].name+'</span><span class="right"></span></a>'}app+='<a href="#" rel="all" class="ship_class_all button_small" onclick="fleetMove.clickClass(event,\'all\'); return false;"><span class="left"></span><span class="txt">'+lng.fleetControll_allClass+'</span><span class="right"></span></a>';var d=new Array("#2");var c=new Array(lng.fleetControll_Base);buttonText=(b.fleet_id==0)?lng.fleetControll_FleetNotAvailable:global.textArrayReplace(d,c,lng.fleetControll_fleetMoveToFleetButtonHint);app+='</div>\n<div class="buttons">\n<input type="button" name="fleet0" value="'+lng.fleetControll_Base+'" class="button_small'+(0==b.fleet_id?' inactive"':'" onclick="fleetMove.moveFleetTo(0)"')+' title="'+buttonText+'" rel="'+buttonText+'" />\n';for(i=1;i<=4;i++){c[0]=lng.fleetControll_Fleet+i;buttonText=(i==b.fleet_id||$.inArray(i,disabledFleets)>-1)?lng.fleetControll_FleetNotAvailable:global.textArrayReplace(d,c,lng.fleetControll_fleetMoveToFleetButtonHint);app+='<input type="button" title="'+buttonText+'" rel="'+buttonText+'" name="fleet'+i+'" value="'+lng.fleetControll_Fleet+" "+i+'" class="button_small'+(i==b.fleet_id||$.inArray(i,disabledFleets)>-1?' inactive"':'" onclick="fleetMove.moveFleetTo('+i+')"')+" />"}app+="</div>\n  </div>";$("#fleet > .content").append(app);pos=$(a).position();$("#"+fleetMove.active).css({left:pos.left-86,top:pos.top-74});$("#"+fleetMove.active+" > h2 > a.close").bind("click",function(e){if(jQuery.browser.msie){e.cancelBubble=true}else{e.stopPropagation()}fleetMove.doHide($(e.target).parents(".overlayer"));return false});$("#"+fleetMove.active+" > *").bind("mouseover",function(f){clearTimeout(fleetMove.tmr[fleetMove.info.fleet_id])});$("#"+fleetMove.active+" > div").bind("mouseout",function(f){fleetMove.hideOverLayer(f)});$("#"+fleetMove.active).bind("click",function(f){if($(f.target).attr("id")==fleetMove.active){fleetMove.doHide(f.target)}});return false},clickClass:function(a,b){if(jQuery.browser.msie){a.cancelBubble=true}else{a.stopPropagation()}element=$("#fleet_"+fleetMove.info.fleet_id+"_over > .classes > .ship_class_"+b);if($(element).hasClass("inactive")){return false}if(b=="all"){if($(element).hasClass("selected")){$("#fleet_"+fleetMove.info.fleet_id+"_over > .classes > a:not(.inactive)").removeClass("selected");fleetMove.info.classes=[];fleetMove.setFleetMoveTitle()}else{fleetMove.info.classes=$.merge(["all"],fleetClasses[fleetMove.info.fleet_id]);$("#fleet_"+fleetMove.info.fleet_id+"_over > .classes > a:not(.inactive)").addClass("selected");$(element).addClass("selected");fleetMove.setFleetMoveTitle()}return false}if($(element).hasClass("selected")){$(element).removeClass("selected");$("#fleet_"+fleetMove.info.fleet_id+"_over > .classes > .ship_class_all").removeClass("selected");fleetMove.info.classes=$.grep(fleetMove.info.classes,function(c){return c!=b&&c!="all"})}else{$(element).addClass("selected");$("#fleet_"+fleetMove.info.fleet_id+"_over > .classes > .ship_class_all").removeClass("selected");fleetMove.info.classes=$.grep(fleetMove.info.classes,function(c){return c!="all"});fleetMove.info.classes.push(b);if(fleetMove.info.classes.length==fleetClasses[fleetMove.info.fleet_id].length){$("#fleet_"+fleetMove.info.fleet_id+"_over > .classes > .ship_class_all").click()}}fleetMove.setFleetMoveTitle();return false},setFleetMoveTitle:function(){$("#"+fleetMove.active+" > .buttons > input").each(function(a,b){var c="";if(fleetMove.info.classes[0]=="all"){c=""}else{if(fleetMove.info.classes.length){$(fleetMove.info.classes).each(function(d,e){c+=shipClasses[e-1].longName+(d<fleetMove.info.classes.length-1?", ":"")})}}$(b).attr("title",$(b).attr("rel").replace("#1",c))})},moveFleetTo:function(a){fleetMove.doHide("#"+fleetMove.active,true);fleetMove.showLoading();$.post("/new/web/fleet/moveFleet",{classes:fleetMove.info.classes,fromFleet:fleetMove.info.fleet_id,toFleet:a},function(b){if(b.status==true){var d=0;$.each(b.to,function(f,e){$("#"+f).fadeTo("fast",0.0001,function(){d++;$("#"+f).html(global.numberFormat(e));$("#"+f).fadeTo("fast",1);if(d==$(".fleet_"+b.toFleet).size()){if(b.fromFleet!=0){$(".galaxy_speed > .fleetdet_"+b.fromFleet).html(global.numberFormat(b.fromData.speed.galaxy,"-"));$(".system_speed > .fleetdet_"+b.fromFleet).html(global.numberFormat(b.fromData.speed.system,"-"));$(".universe_speed > .fleetdet_"+b.fromFleet).html(global.numberFormat(b.fromData.speed.universe,"-"));$(".galaxy_fuel > .fleetdet_"+b.fromFleet).html(global.numberFormat(b.fromData.fuel.galaxy,"-"));$(".system_fuel > .fleetdet_"+b.fromFleet).html(global.numberFormat(b.fromData.fuel.system,"-"));$(".universe_fuel > .fleetdet_"+b.fromFleet).html(global.numberFormat(b.fromData.fuel.universe,"-"))}if(b.toFleet!=0){$(".galaxy_speed > .fleetdet_"+b.toFleet).html(global.numberFormat(b.toData.speed.galaxy,"-"));$(".system_speed > .fleetdet_"+b.toFleet).html(global.numberFormat(b.toData.speed.system,"-"));$(".universe_speed > .fleetdet_"+b.toFleet).html(global.numberFormat(b.toData.speed.universe,"-"));$(".galaxy_fuel > .fleetdet_"+b.toFleet).html(global.numberFormat(b.toData.fuel.galaxy,"-"));$(".system_fuel > .fleetdet_"+b.toFleet).html(global.numberFormat(b.toData.fuel.system,"-"));$(".universe_fuel > .fleetdet_"+b.toFleet).html(global.numberFormat(b.toData.fuel.universe,"-"))}fleetMove.rebuildClasses(b.toFleet)}})});var c=0;$.each(b.from,function(f,e){$("#"+f).fadeTo("fast",0.0001,function(){c++;$("#"+f).html(e);$("#"+f).fadeTo("fast",1);if(c==$(".fleet_"+b.fromFleet).size()){fleetMove.rebuildClasses(b.fromFleet)}})})}else{fleetMove.showError(b.errorMsg)}fleetMove.hideLoading()},"json")},rebuildClasses:function(a){fleetClasses[a]=new Array();$(".fleet_"+a).each(function(c,b){if(parseInt($(b).html())>0){fleetClasses[a].push(parseInt($(b).attr("class").match(/shipclass_([0-9]+)/)[1]));$(b).removeClass("inactive");$(b).attr("title",lng.fleetControll_ClickToMove)}else{$(b).addClass("inactive");$(b).attr("title",lng.fleetControll_FleetNotAvailable)}});fleetClasses[a]=$.unique(fleetClasses[a]);if(fleetClasses[a].length==0){$("#fleet_"+a).addClass("inactive");$("#fleet_"+a).attr("title",lng.fleetControll_FleetNotAvailable)}else{$("#fleet_"+a).removeClass("inactive");$("#fleet_"+a).attr("title",lng.fleetControll_ClickToMove)}fleetControl.init()},showError:function(a,b){if(fleetMove.errtmr){clearTimeout(fleetMove.errtmr)}if($("#fleet > .content > .error").length==0){app='<div class="error"></div>';$("#fleet > .content").append(app)}$("#fleet > .content > .error").html(a);$("#fleet > .content > .error").css({left:b[0],top:b[1]});$("#fleet > .content > .error").fadeTo("fast",0.8,function(){fleetMove.errtmr=setTimeout(function(){$("#fleet > .content > .error").fadeOut()},2000)})},showLoading:function(){if($("#fleet > .content > .loading").length==0){app='<div class="loading"></div>';$("#fleet > .content").append(app)}$("#fleet > .content").css("position","relative");$("#fleet > .content > .loading").css({width:$("#fleet > .content").outerWidth(),height:$("#fleet > .content").outerHeight()});$("#fleet > .content > .loading").fadeTo("fast",0.8)},hideLoading:function(){$("#fleet > .content > .loading").fadeOut("fast",function(){$("#fleet > .content").css("position","static")})}};fleetControl={fleetOptions:new Array(),init:function(){$(fleetClasses).each(function(b,a){if(fleetControl.fleetOptions[b]===undefined){fleetControl.fleetOptions[b]=$("#task_"+b).html()}else{$("#task_"+b).html(fleetControl.fleetOptions[b])}if(b==0){return}if(a.length==0){$("#task_"+b).attr("disabled","disabled");$("#delay_"+b).attr("disabled","disabled");$("#task_"+b+" > option").html(lng.fleetControll_NotAvailable)}else{$("#task_"+b).removeAttr("disabled");$("#delay_"+b).removeAttr("disabled")}});$(disabledFleets).each(function(b,a){if($("#task_"+a).parents("tr").hasClass("defend")||$("#task_"+a).parents("tr").hasClass("attack")||$("#task_"+a).parents("tr").hasClass("scout")){$("#task_"+a).html('<option value="0#0">'+lng.fleetControll_DoNothing+'</option>\n  <option value="9#0">'+lng.fleetControll_Callback+"</option>");$("#task_"+a).removeAttr("disabled")}else{$("#task_"+a).html('<option value="0#0">'+lng.fleetControll_NotAvailable+'</option>\n  <option value="9#0">'+lng.fleetControll_Callback+"</option>")}$("#delay_"+a).attr("disabled","disabled")});if(hasExtra==false){$("select[name*='delay']").attr("disabled","disabled")}for(i=1;i<=4;i++){$("#task_"+i+"_input").remove();$("#task_"+i+"_container").remove();$("#delay_"+i+"_input").remove();$("#delay_"+i+"_container").remove();$("#task_"+i).selectbox();$("#delay_"+i).selectbox()}},doIt:function(){var a=false;$("select[name*=task]").each(function(c,b){if($(b).val()!="0#0"){a=true}});if(!a){global.message.show("#fleet_controll",lng.fleetControll_FleetControll,'<span class="errmsg">'+lng.fleetControll_errorNoTask+"</span>");return false}global.loadingLayer.show("#contents");$.post("/new/web/fleet/doit",$("#fleet_action").serialize(),function(d){var c=false;var b=false;var e="";$.each(d,function(g,f){if(f.status===true){if(f.delay>0){from=new Array("#1");to=[f.delay];delay=global.textArrayReplace(from,to,lng.fleetControll_delayReplace)}else{delay=""}if(f.task!="Callback"){from=new Array("#1","#2","#3");to=new Array(f.round,f.target.planet_name+"("+f.target.r+":"+f.target.x+":"+f.target.y+":"+f.target.z+")",delay);txt=global.textArrayReplace(from,to,lng["fleetControll_ok"+f.task])}else{txt=lng["fleetControll_ok"+f.task]}c=true}else{e+=lng.fleetControll_error+" "+lng.fleetControll_Fleet+" "+g+': <span class="errmsg">'+lng["fleetControll_error"+f.status]+"</span><br />";b=true}});if(c&&!b){window.location.reload();return false}global.loadingLayer.hide();global.message.show("#fleet_controll",lng.fleetControll_FleetControll,e,lng.fleetControll_popupBack,function(){if(c){global.loadingLayer.show("#contents");window.location.reload()}})});return false}};registration={defValues:{},init:function(){$("input[name|=password]").passStrength({userid:"#login_name",shortPassText:lng.registration_passStrength_short,badPassText:lng.registration_passStrength_bad,goodPassText:lng.registration_passStrength_good,strongPassText:lng.registration_passStrength_strong});$("input").focus(function(a){if(registration.defValues[$(a.target).attr("name")]==undefined){registration.defValues[$(a.target).attr("name")]=$(a.target).val()}if($(a.target).attr("rel")){registration.showHint($(a.target))}if($(a.target).attr("name").match(/password_fake/)){$(a.target).parents("td").children("input[type|=password]").show();$(a.target).parents("td").children("input[type|=password]").focus();$(a.target).hide()}else{if($(a.target).val()==registration.defValues[$(a.target).attr("name")]){$(a.target).val("")}}});$("input").blur(function(a){$("#hint_"+$(a.target).attr("name")).hide();if($(a.target).val()==""){$(a.target).val(registration.defValues[$(a.target).attr("name")])}if($(a.target).attr("type")=="password"&&$(a.target).val()==registration.defValues[$(a.target).attr("name")]){$(a.target).hide();$(a.target).parents("td").children("input[type|=text]").show()}})},showHint:function(a){divId="hint_"+a.attr("name");if(!$("#"+divId).length){app='<div class="hint" id="'+divId+'">'+a.attr("rel");+"</div>";$("body").append(app);position=a.position();position.left+=$(".right").position().left+a.width()+10;position.top=position.top+(a.attr("name")=="password"?6:0);$("#"+divId).css("top",position.top);$("#"+divId).css("left",position.left)}$("#"+divId).show()},doIt:function(a){global.loadingLayer.show();$.post(a,$("#frm_registration").serialize(),function(b){global.loadingLayer.hide();if(b.status){registration.registerDone(b.email)}else{registration.showErrors(b.errors)}},"json")},showErrors:function(a){$("input").removeClass("bad");$(".errmsg").remove();txt="<ul>";$.each(a,function(c,b){txt+='<li class="errmsg">'+lng["registration_error"+b]+"</li>"});txt+="</ul>";global.message.show(null,lng.registration_title,txt)},registerDone:function(a){$("#frm_registration").html("<h3>"+lng.registration_done+"</h3>"+lng.registration_doneText);$("#email").html(a)}};